# SAFEWORD Framework Setup Guide

A single place to install and understand the SAFEWORD framework in your project.

## What you get

- `.safeword/SAFEWORD.md` and guides for workflows, TDD, and best practices
- `.safeword/templates/` for user stories, test definitions, and design docs
- `.safeword/planning/` and `.safeword/tickets/` structure
- `.claude/` hooks and settings for:
  - Auto-linting (PostToolUse)
  - Quality review (Stop hook)
  - Session start version message

All scripts are idempotent and safe to re-run.

## Requirements

- bash
- jq (required for hook settings merging)
  - macOS: `brew install jq`
  - Ubuntu/Debian: `sudo apt-get install jq`
- Node.js + npm (only for auto-linting setup)

## Recommended setup (2 commands)

```bash
cd /path/to/your/project

# 1) Install SAFEWORD structure and docs (planning, guides, templates)
bash ./framework/scripts/setup-safeword.sh

# 2) Install hooks (auto-linting + quality review)
bash ./framework/scripts/setup-claude.sh
```

Options for step 2:
- Skip linting (quality review only): `bash ./framework/scripts/setup-claude.sh --skip-linting`
- Skip quality review: `bash ./framework/scripts/setup-claude.sh --skip-quality`

## What each script does

### setup-safeword.sh (Project structure + docs)
- Copies `framework/SAFEWORD.md` to `.safeword/SAFEWORD.md`
- Copies `framework/guides/` and `framework/templates/` into `.safeword/`
- Creates `.safeword/planning/` and `.safeword/tickets/` (with archives)
- Creates or updates `AGENTS.md` with an always-read trigger for `@./.safeword/SAFEWORD.md`
- Ensures `.gitignore` includes `.safeword` planning folders and Claude local files
- Creates `.claude/settings.json` if missing

Note: Hook binaries are created by the scripts below. Running `setup-claude.sh` installs them.

### setup-claude.sh (Hooks orchestrator)
- Auto-detects project type (react, astro, electron, typescript, minimal) unless `--linting-mode` is provided
- Runs linting setup unless `--skip-linting`
- Runs quality review setup unless `--skip-quality`
- Seeds `.claude/skills/` and `.claude/mcp/` from `framework/skills` and `framework/mcp` if present
- Adds a sample Arcade MCP config and environment example if missing
- Ensures `CLAUDE.md` references `.safeword/SAFEWORD.md`

### setup-linting.sh (Auto-linting)
- **Auto-detects** project type from package.json and tsconfig.json
- Installs ESLint + Prettier + framework-specific plugins as needed
- All projects include:
  - `eslint-plugin-boundaries` (architectural boundary enforcement)
  - `eslint-plugin-sonarjs` (code smell detection)
  - `@microsoft/eslint-plugin-sdl` (security rules)
- Creates:
  - `.claude/hooks/run-linters.sh` (shared logic)
  - `.claude/hooks/auto-lint.sh` (PostToolUse wrapper)
  - `.claude/commands/lint.md`
  - `.claude/settings.json` merged with PostToolUse hook
  - `eslint.config.mjs` (single config for all detected frameworks)
  - `.prettierrc` and `.prettierignore`

Override detection: `--no-typescript`, `--no-react`, `--no-astro`

### setup-quality.sh (Quality review)
- Creates:
  - `.claude/hooks/auto-quality-review.sh` (Stop hook that inspects transcript)
  - `.claude/hooks/run-quality-review.sh` (prompt)
  - `.claude/commands/quality-review.md`
  - `.claude/settings.json` merged with Stop + SessionStart hooks

Behavior:
- Triggers only when changes are proposed/made (JSON blob present)
- Skips when the assistant asked a question (waits for your answer)
- Works in monorepos by searching upward for `SAFEWORD.md` or `CLAUDE.md`
- Configurable via `.auto-quality-review.config`

## Outputs checklist

After recommended setup:
- `.safeword/SAFEWORD.md` and `.safeword/guides/`
- `.claude/hooks/auto-lint.sh`, `run-linters.sh`, `auto-quality-review.sh`, `run-quality-review.sh`, `version-check.sh`
- `.claude/commands/lint.md`, `quality-review.md`
- `.claude/settings.json` with:
  - `PostToolUse` → `auto-lint.sh`
  - `Stop` → `auto-quality-review.sh`
  - `SessionStart` → `version-check.sh`

## Updating

Re-run the same scripts. Generated files include version headers like:
```bash
# Generated by setup-linting.sh v1.0.0
# To upgrade: Re-run this script in this project
```

## Troubleshooting

- jq missing: Install jq (see Requirements). Scripts will error clearly when required.
- Node missing: Install Node.js + npm to use auto-linting.
- Hooks not triggering:
  - Check `.claude/settings.json`
  - Ensure `SAFEWORD.md` or `CLAUDE.md` exists in project or parent
  - See `.safeword/SAFEWORD.md` (methodology) and this guide (setup/troubleshooting)


