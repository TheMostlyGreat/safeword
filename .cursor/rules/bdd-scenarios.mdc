---
description: USE WHEN in BDD define-behavior or scenario-gate phase. Guides Given/When/Then scenario creation and validation.
alwaysApply: false
---

# Phase 3-4: Define Behavior & Scenario Gate

## Phase 3: Define Behavior

**Entry:** `define-behavior` phase

**Draft scenarios:**

1. Read spec goal/scope
2. Draft Given/When/Then covering:
   - Happy path (main success)
   - Failure modes (what can go wrong)
   - Edge cases (boundaries, empty states)
3. Present to user, iterate
4. Save to `.safeword-project/tickets/{id}-{slug}/test-definitions.md`
5. Each scenario gets `[ ]` checkbox

**Exit:** User approves → update to `scenario-gate`

---

## Phase 4: Scenario Quality Gate

**Validate each scenario:**

| Criterion         | Check                          | Red flag                        |
| ----------------- | ------------------------------ | ------------------------------- |
| **Atomic**        | Tests ONE behavior             | Multiple When/Then pairs        |
| **Observable**    | Has externally visible outcome | Internal state only             |
| **Deterministic** | Same result on repeat          | Time/random dependency          |

**Report issues:**

- Group by type
- Suggest fix: "Scenario 3 tests login AND session. Split into two."

**Exit:** All pass OR user acknowledges → update to `decomposition`
